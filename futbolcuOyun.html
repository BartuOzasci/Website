<!DOCTYPE html>
<html lang="tr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>DeMarke â€” Online Futbol Kart Oyunu</title>
    <script src="https://cdn.socket.io/4.5.0/socket.io.min.js"></script>
    <style>
      :root {
        --bg: #071022;
        --card: #0f1724;
        --muted: #9aa6b2;
        --accent: #ff6b35;
        --accent2: #ffd166;
        --gold: #ffdd57;
        --glass: rgba(255, 255, 255, 0.03);
        --success: #2ecc71;
        --danger: #e74c3c;
      }

      * {
        box-sizing: border-box;
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      }

      body {
        margin: 0;
        background: linear-gradient(180deg, #051025 0%, #071022 100%);
        color: #e6eef6;
        min-height: 100vh;
        display: flex;
        flex-direction: column;
        align-items: center;
        padding: 18px;
      }

      .app {
        width: 100%;
        max-width: 1200px;
      }

      header {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 12px;
        margin-bottom: 20px;
        text-align: center;
      }

      h1 {
        margin: 0;
        font-size: 28px;
        color: var(--accent);
        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
      }

      .scoreboard {
        display: flex;
        gap: 20px;
        align-items: center;
      }

      .score {
        background: var(--card);
        padding: 12px 20px;
        border-radius: 12px;
        box-shadow: 0 6px 18px rgba(0, 0, 0, 0.6);
        text-align: center;
        min-width: 120px;
        position: relative;
      }

      .score .who {
        font-size: 14px;
        color: var(--muted);
      }

      .score .val {
        font-size: 24px;
        font-weight: 800;
        color: var(--gold);
      }

      .room-info {
        background: var(--card);
        padding: 15px;
        border-radius: 12px;
        margin-top: 10px;
        text-align: center;
      }

      .room-code {
        font-size: 24px;
        font-weight: bold;
        color: var(--accent);
        margin: 10px 0;
      }

      .player-list {
        display: flex;
        gap: 15px;
        justify-content: center;
        margin-top: 10px;
      }

      .player {
        padding: 8px 15px;
        background: rgba(255, 255, 255, 0.05);
        border-radius: 8px;
      }

      .player.me {
        background: var(--accent);
        color: white;
      }

      .controls {
        margin-top: 14px;
        display: flex;
        flex-direction: column;
        gap: 15px;
      }

      .card-creator {
        background: var(--card);
        padding: 20px;
        border-radius: 14px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.6);
      }

      .card-creator label {
        display: block;
        color: var(--muted);
        font-size: 14px;
        margin-bottom: 10px;
      }

      .names-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 12px;
        margin-bottom: 15px;
      }

      @media (min-width: 768px) {
        .names-grid {
          grid-template-columns: repeat(4, 1fr);
        }
      }

      input[type="text"] {
        width: 100%;
        padding: 12px;
        border-radius: 8px;
        border: none;
        background: var(--glass);
        color: inherit;
        font-size: 14px;
      }

      button {
        border: none;
        padding: 12px 18px;
        border-radius: 10px;
        font-weight: 700;
        cursor: pointer;
        transition: all 0.3s ease;
        font-size: 14px;
      }

      button.btn {
        background: linear-gradient(90deg, var(--accent), var(--accent2));
        color: #051022;
      }

      button.btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(255, 107, 53, 0.4);
      }

      button.ghost {
        background: transparent;
        border: 1px solid rgba(255, 255, 255, 0.1);
        color: var(--muted);
      }

      button.ghost:hover {
        background: rgba(255, 255, 255, 0.05);
      }

      .button-group {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
      }

      .board {
        display: flex;
        flex-direction: column;
        gap: 20px;
        margin-top: 20px;
      }

      @media (min-width: 992px) {
        .board {
          flex-direction: row;
        }

        .left-panel {
          flex: 2;
        }

        .right-panel {
          flex: 1;
          max-width: 400px;
        }
      }

      .left-panel,
      .right-panel {
        background: linear-gradient(
          180deg,
          rgba(255, 255, 255, 0.02),
          rgba(0, 0, 0, 0.2)
        );
        padding: 20px;
        border-radius: 14px;
      }

      .cards-wrap {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
        gap: 15px;
        justify-content: center;
      }

      .player-card {
        border-radius: 12px;
        background: linear-gradient(
          180deg,
          rgba(255, 255, 255, 0.02),
          rgba(255, 255, 255, 0.01)
        );
        border: 2px solid rgba(255, 255, 255, 0.06);
        display: flex;
        flex-direction: column;
        overflow: hidden;
        cursor: pointer;
        transition: transform 0.3s ease, box-shadow 0.3s ease, opacity 0.3s ease;
        aspect-ratio: 2/3;
      }

      .player-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
      }

      .player-card.gold {
        border-color: rgba(255, 221, 87, 0.8);
        box-shadow: 0 10px 30px rgba(255, 178, 18, 0.15);
      }

      .player-card.selected {
        transform: translateY(-10px) scale(1.03);
        z-index: 3;
        box-shadow: 0 18px 40px rgba(0, 0, 0, 0.6);
        border-color: var(--accent);
      }

      .player-card.used {
        opacity: 0.5;
        filter: grayscale(0.7);
        cursor: not-allowed;
      }

      .player-card .img {
        height: 70%;
        background: #0b1220;
        background-size: cover;
        background-position: center;
        background-repeat: no-repeat;
      }

      .player-card .meta {
        padding: 12px;
        display: flex;
        flex-direction: column;
        gap: 8px;
        flex: 1;
        justify-content: center;
        align-items: center;
      }

      .player-card .name {
        font-weight: 800;
        font-size: 16px;
        letter-spacing: 0.4px;
        text-align: center;
      }

      .player-card .sub {
        font-size: 12px;
        color: var(--muted);
        text-align: center;
      }

      .panel-title {
        font-weight: 800;
        font-size: 18px;
        margin-bottom: 15px;
        color: var(--accent);
      }

      .game-controls {
        background: var(--card);
        padding: 20px;
        border-radius: 14px;
        margin-bottom: 20px;
      }

      .question-box {
        background: rgba(255, 255, 255, 0.02);
        padding: 15px;
        border-radius: 10px;
        margin-bottom: 15px;
      }

      .question {
        font-weight: 700;
        font-size: 16px;
        line-height: 1.4;
      }

      .choice-row {
        display: flex;
        gap: 10px;
        align-items: center;
        flex-wrap: wrap;
      }

      .big-btn {
        padding: 12px 20px;
        border-radius: 10px;
        border: none;
        background: linear-gradient(90deg, #2b394f, #273542);
        color: #fff;
        cursor: pointer;
        font-weight: 700;
        flex: 1;
        min-width: 140px;
      }

      .big-btn:hover {
        background: linear-gradient(90deg, #34495e, #2c3e50);
      }

      .big-btn:disabled {
        opacity: 0.5;
        cursor: not-allowed;
      }

      .history {
        margin-top: 8px;
        max-height: 200px;
        overflow: auto;
        padding-right: 6px;
        color: var(--muted);
        font-size: 13px;
      }

      .history-item {
        padding: 8px 10px;
        border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        line-height: 1.4;
      }

      .round-info {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 15px;
        padding: 10px 15px;
        background: rgba(255, 255, 255, 0.03);
        border-radius: 10px;
      }

      .round-label {
        font-weight: 700;
        font-size: 16px;
      }

      .turn-indicator {
        display: flex;
        gap: 10px;
        margin-bottom: 15px;
      }

      .turn-btn {
        flex: 1;
        text-align: center;
        padding: 10px;
        border-radius: 8px;
        background: rgba(255, 255, 255, 0.05);
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .turn-btn.active {
        background: var(--accent);
        color: white;
      }

      .card-modal {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.8);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 100;
        opacity: 0;
        pointer-events: none;
        transition: opacity 0.3s ease;
      }

      .card-modal.active {
        opacity: 1;
        pointer-events: all;
      }

      .card-modal-content {
        background: var(--card);
        padding: 20px;
        border-radius: 15px;
        text-align: center;
        max-width: 800px;
        width: 90%;
        box-shadow: 0 15px 30px rgba(0, 0, 0, 0.5);
        transform: scale(0.9);
        transition: transform 0.3s ease;
      }

      .card-modal.active .card-modal-content {
        transform: scale(1);
      }

      .cards-comparison {
        display: flex;
        gap: 20px;
        justify-content: center;
        margin: 20px 0;
        flex-wrap: wrap;
      }

      .card-display {
        background: rgba(255, 255, 255, 0.05);
        border-radius: 12px;
        padding: 15px;
        width: 180px;
        border: 2px solid rgba(255, 255, 255, 0.1);
      }

      .card-display.gold {
        border-color: var(--gold);
        box-shadow: 0 0 20px rgba(255, 221, 87, 0.3);
      }

      .card-display .card-image {
        width: 100%;
        height: 120px;
        background-size: cover;
        background-position: center;
        border-radius: 8px;
        margin-bottom: 10px;
      }

      .card-display .card-name {
        font-weight: bold;
        margin-bottom: 5px;
      }

      .card-display .card-owner {
        font-size: 12px;
        color: var(--muted);
      }

      .footer {
        margin-top: 30px;
        text-align: center;
        color: var(--muted);
        font-size: 13px;
        padding: 10px;
      }

      .card-appear {
        animation: cardAppear 0.5s ease both;
      }

      @keyframes cardAppear {
        from {
          transform: translateY(20px);
          opacity: 0;
        }
        to {
          transform: none;
          opacity: 1;
        }
      }

      .online-status {
        display: flex;
        align-items: center;
        gap: 8px;
        margin-top: 10px;
        font-size: 14px;
      }

      .status-indicator {
        width: 10px;
        height: 10px;
        border-radius: 50%;
        background: var(--success);
      }

      .status-indicator.offline {
        background: var(--danger);
      }

      .waiting-message {
        background: var(--card);
        padding: 20px;
        border-radius: 14px;
        text-align: center;
        margin: 20px 0;
      }
    </style>
  </head>
  <body>
    <div class="app">
      <header>
        <h1>DeMarke â€” Online Futbol Kart Oyunu</h1>
        <div class="scoreboard">
          <div class="score">
            <div class="who">Ben</div>
            <div id="myScore" class="val">0</div>
          </div>
          <div class="score">
            <div class="who">Rakip</div>
            <div id="oppScore" class="val">0</div>
          </div>
        </div>

        <div class="room-info">
          <div>Oda Kodu:</div>
          <div class="room-code" id="roomCode">YÃ¼kleniyor...</div>
          <div class="player-list" id="playerList">
            <!-- Oyuncular burada gÃ¶sterilecek -->
          </div>
          <button id="copyLink" class="btn" style="margin-top: 10px">
            Linki Kopyala
          </button>
        </div>

        <div class="online-status">
          <div class="status-indicator" id="statusIndicator"></div>
          <span id="statusText">BaÄŸlanÄ±yor...</span>
        </div>
      </header>

      <div class="controls">
        <div class="card-creator">
          <label>8 Futbolcu Ä°smi Girin</label>
          <div class="names-grid" id="namesGrid">
            <!-- 8 inputs will be added here -->
          </div>
          <div class="button-group">
            <button id="createBtn" class="btn">
              KartlarÄ± OluÅŸtur ve Oyunu BaÅŸlat
            </button>
            <button id="fillSample" class="ghost">Ã–rnek Ä°simleri Doldur</button>
          </div>
        </div>
      </div>

      <div id="waitingMessage" class="waiting-message" style="display: none">
        <h3>Rakip Bekleniyor...</h3>
        <p>
          Linki arkadaÅŸÄ±nÄ±zla paylaÅŸÄ±n. Ä°kinci oyuncu katÄ±ldÄ±ÄŸÄ±nda oyun otomatik
          baÅŸlayacak.
        </p>
      </div>

      <div class="board" id="gameBoard" style="display: none">
        <div class="left-panel">
          <div class="panel-title">Kart Havuzu</div>
          <div class="cards-wrap" id="cardsWrap">
            <!-- Cards will be added here -->
          </div>
        </div>

        <div class="right-panel">
          <div class="panel-title">Oyun Kontrolleri</div>

          <div class="game-controls">
            <div class="round-info">
              <div class="round-label" id="roundLabel">Tur 1 / 8</div>
              <div id="turnIndicator">SÄ±ra: Bekleniyor</div>
            </div>

            <div class="question-box">
              <div
                style="font-size: 14px; color: var(--muted); margin-bottom: 8px"
              >
                Mevcut Tur
              </div>
              <div id="currentQuestion" class="question">
                Rakip bekleniyor...
              </div>
            </div>

            <div class="choice-row">
              <button id="playCardBtn" class="big-btn" disabled>
                Kart SeÃ§
              </button>
            </div>
          </div>

          <div class="panel-title">Oyun GeÃ§miÅŸi</div>
          <div id="history" class="history">
            <!-- History items will be added here -->
          </div>
        </div>
      </div>

      <!-- Kart GÃ¶rÃ¼ntÃ¼leme Modal'Ä± -->
      <div class="card-modal" id="cardModal">
        <div class="card-modal-content">
          <div class="panel-title">SeÃ§ilen Kartlar</div>
          <div class="cards-comparison" id="cardsComparison">
            <!-- Kartlar burada gÃ¶sterilecek -->
          </div>
          <button id="closeCardModal" class="btn" style="margin-top: 15px">
            Tamam
          </button>
        </div>
      </div>

      <div class="footer">
        DeMarke Online Futbol Kart Oyunu | Linki paylaÅŸarak arkadaÅŸÄ±nÄ±zla
        oynayÄ±n
      </div>
    </div>

    <script>
      // Socket.io baÄŸlantÄ±sÄ±
      const socket = io("https://demarke-socket-server.onrender.com"); // Ãœcretsiz socket sunucusu

      // DOM Elements
      const namesGrid = document.getElementById("namesGrid");
      const createBtn = document.getElementById("createBtn");
      const fillSample = document.getElementById("fillSample");
      const cardsWrap = document.getElementById("cardsWrap");
      const currentQuestionEl = document.getElementById("currentQuestion");
      const playCardBtn = document.getElementById("playCardBtn");
      const historyEl = document.getElementById("history");
      const myScoreEl = document.getElementById("myScore");
      const oppScoreEl = document.getElementById("oppScore");
      const roundLabel = document.getElementById("roundLabel");
      const turnIndicator = document.getElementById("turnIndicator");
      const statusIndicator = document.getElementById("statusIndicator");
      const statusText = document.getElementById("statusText");
      const roomCodeEl = document.getElementById("roomCode");
      const playerListEl = document.getElementById("playerList");
      const copyLinkBtn = document.getElementById("copyLink");
      const waitingMessage = document.getElementById("waitingMessage");
      const gameBoard = document.getElementById("gameBoard");

      // Yeni modal elementleri
      const cardModal = document.getElementById("cardModal");
      const cardsComparison = document.getElementById("cardsComparison");
      const closeCardModal = document.getElementById("closeCardModal");

      // Game State
      let myScore = 0,
        oppScore = 0;
      let inputs = [];
      let players = [];
      let goldIndexes = new Set();
      let selectedCardIndex = null;
      let currentRound = 1;
      let totalRounds = 8;
      let isMyTurn = false;
      let gameActive = false;
      let usedCards = new Set();
      let roomId = null;
      let playerId = null;
      let playerName = "";
      let opponentName = "";
      let isHost = false;

      // Initialize name inputs
      for (let i = 0; i < 8; i++) {
        const inp = document.createElement("input");
        inp.type = "text";
        inp.placeholder = `Futbolcu ${i + 1}`;
        inp.dataset.idx = i;
        namesGrid.appendChild(inp);
        inputs.push(inp);
      }

      // Sample names
      const sampleNames = [
        "Lionel Messi",
        "Cristiano Ronaldo",
        "Kylian MbappÃ©",
        "Neymar Jr",
        "Erling Haaland",
        "Kevin De Bruyne",
        "Luka ModriÄ‡",
        "Sadio ManÃ©",
      ];

      // Fill sample names
      fillSample.addEventListener("click", () => {
        for (let i = 0; i < 8; i++) {
          inputs[i].value = sampleNames[i] || `Futbolcu ${i + 1}`;
        }
      });

      // Socket event handlers
      socket.on("connect", () => {
        statusIndicator.classList.remove("offline");
        statusText.textContent = "BaÄŸlandÄ±";
        playerId = socket.id;

        // URL'den oda ID'sini al veya yeni oda oluÅŸtur
        const urlParams = new URLSearchParams(window.location.search);
        roomId = urlParams.get("room");

        if (roomId) {
          // Mevcut odaya katÄ±l
          socket.emit("join-room", roomId);
          isHost = false;
          statusText.textContent = "Odaya katÄ±lÄ±yor...";
        } else {
          // Yeni oda oluÅŸtur
          socket.emit("create-room");
          isHost = true;
          statusText.textContent = "Oda oluÅŸturuluyor...";
        }
      });

      socket.on("disconnect", () => {
        statusIndicator.classList.add("offline");
        statusText.textContent = "BaÄŸlantÄ± kesildi";
      });

      socket.on("room-created", (data) => {
        roomId = data.roomId;
        roomCodeEl.textContent = roomId;
        statusText.textContent = "Oda oluÅŸturuldu, rakip bekleniyor";
        updateURL();
      });

      socket.on("room-joined", (data) => {
        roomId = data.roomId;
        roomCodeEl.textContent = roomId;
        statusText.textContent = "Odaya katÄ±ldÄ±nÄ±z";
        updatePlayersList(data.players);
        updateURL();
      });

      socket.on("player-joined", (data) => {
        updatePlayersList(data.players);
        statusText.textContent = "Rakip katÄ±ldÄ±!";

        if (isHost) {
          // Oyunu baÅŸlatma butonunu aktif et
          createBtn.disabled = false;
          createBtn.textContent = "KartlarÄ± OluÅŸtur ve Oyunu BaÅŸlat";
        } else {
          waitingMessage.style.display = "block";
          waitingMessage.innerHTML =
            "<h3>Oyun BaÅŸlatÄ±lmasÄ± Bekleniyor...</h3><p>Oyun kurucusu oyunu baÅŸlatacak.</p>";
        }
      });

      socket.on("player-left", (data) => {
        updatePlayersList(data.players);
        statusText.textContent = "Rakip ayrÄ±ldÄ±";
        gameActive = false;
        playCardBtn.disabled = true;
        waitingMessage.style.display = "block";
        waitingMessage.innerHTML =
          "<h3>Rakip AyrÄ±ldÄ±</h3><p>Yeni bir rakip bekleniyor...</p>";
      });

      socket.on("game-started", (data) => {
        players = data.players;
        goldIndexes = new Set(data.goldIndexes);
        currentRound = 1;
        gameActive = true;

        // UI'Ä± gÃ¼ncelle
        waitingMessage.style.display = "none";
        gameBoard.style.display = "flex";
        renderCards();
        updateQuestion();
        updateTurnIndicator(data.currentTurn);

        addToHistory("Oyun baÅŸladÄ±!");
      });

      socket.on("card-selected", (data) => {
        // Rakibin kart seÃ§tiÄŸini gÃ¶ster
        usedCards.add(data.cardIndex);
        document.querySelectorAll(".player-card").forEach((card, idx) => {
          if (usedCards.has(idx)) {
            card.classList.add("used");
          }
        });

        addToHistory(`Rakip kart seÃ§ti: ${players[data.cardIndex].name}`);

        // EÄŸer her iki oyuncu da kart seÃ§tiyse, sonuÃ§larÄ± gÃ¶ster
        if (data.bothSelected) {
          showCardComparison(data.playerCard, data.opponentCard);
        }
      });

      socket.on("turn-changed", (data) => {
        updateTurnIndicator(data.currentTurn);
      });

      socket.on("score-updated", (data) => {
        myScore = data.myScore;
        oppScore = data.oppScore;
        updateScores();
      });

      // Oyunu baÅŸlat
      createBtn.addEventListener("click", () => {
        if (!isHost) {
          alert("Sadece oda kurucusu oyunu baÅŸlatabilir!");
          return;
        }

        // Get names from inputs
        const names = inputs.map(
          (inp, i) => inp.value.trim() || sampleNames[i] || `Futbolcu ${i + 1}`
        );

        // Create player objects
        players = [];
        for (let i = 0; i < 8; i++) {
          const player = {
            id: i,
            name: names[i],
            image: placeholderDataURL(names[i]),
          };
          players.push(player);
        }

        // Mark 3 random cards as gold
        goldIndexes = new Set();
        while (goldIndexes.size < 3) {
          goldIndexes.add(Math.floor(Math.random() * 8));
        }

        // Oyunu baÅŸlat
        socket.emit("start-game", {
          roomId: roomId,
          players: players,
          goldIndexes: Array.from(goldIndexes),
        });
      });

      // Kart seÃ§ butonu
      playCardBtn.addEventListener("click", () => {
        if (!gameActive || !isMyTurn) {
          alert("Åžu anda sÄ±ra sizde deÄŸil!");
          return;
        }

        if (selectedCardIndex === null) {
          alert("LÃ¼tfen bir kart seÃ§in!");
          return;
        }

        // Kart seÃ§imini sunucuya gÃ¶nder
        socket.emit("select-card", {
          roomId: roomId,
          cardIndex: selectedCardIndex,
        });

        // SeÃ§ilen kartÄ± kullanÄ±lmÄ±ÅŸ olarak iÅŸaretle
        usedCards.add(selectedCardIndex);
        document.querySelectorAll(".player-card").forEach((card, idx) => {
          if (usedCards.has(idx)) {
            card.classList.add("used");
          }
        });

        addToHistory(`KartÄ±nÄ±zÄ± seÃ§tiniz: ${players[selectedCardIndex].name}`);

        // SeÃ§imi sÄ±fÄ±rla
        selectedCardIndex = null;
        document.querySelectorAll(".player-card").forEach((card) => {
          card.classList.remove("selected");
        });
        playCardBtn.disabled = true;
      });

      // SeÃ§ilen kartlarÄ± gÃ¶ster
      function showCardComparison(myCardIndex, opponentCardIndex) {
        // Modal iÃ§eriÄŸini temizle
        cardsComparison.innerHTML = "";

        // Kendi kartÄ±mÄ±zÄ± ekle
        const myCard = players[myCardIndex];
        const myCardElement = document.createElement("div");
        myCardElement.className = `card-display ${
          goldIndexes.has(myCardIndex) ? "gold" : ""
        }`;
        myCardElement.innerHTML = `
                <div class="card-image" style="background-image: url('${myCard.image}')"></div>
                <div class="card-name">${myCard.name}</div>
                <div class="card-owner">Sizin KartÄ±nÄ±z</div>
            `;
        cardsComparison.appendChild(myCardElement);

        // Rakip kartÄ±nÄ± gÃ¶ster
        const opponentCard = players[opponentCardIndex];
        const opponentCardElement = document.createElement("div");
        opponentCardElement.className = `card-display ${
          goldIndexes.has(opponentCardIndex) ? "gold" : ""
        }`;
        opponentCardElement.innerHTML = `
                <div class="card-image" style="background-image: url('${opponentCard.image}')"></div>
                <div class="card-name">${opponentCard.name}</div>
                <div class="card-owner">Rakip KartÄ±</div>
            `;
        cardsComparison.appendChild(opponentCardElement);

        // Modal'Ä± gÃ¶ster
        cardModal.classList.add("active");
      }

      // Modal'Ä± kapat
      closeCardModal.addEventListener("click", () => {
        cardModal.classList.remove("active");

        // Sonraki tura geÃ§
        currentRound++;
        if (currentRound > totalRounds) {
          // Oyun bitti
          gameActive = false;
          addToHistory("Oyun bitti! TÃ¼m turlar tamamlandÄ±.");
        } else {
          updateQuestion();
        }
      });

      // Render cards
      function renderCards() {
        cardsWrap.innerHTML = "";
        players.forEach((player, idx) => {
          const card = document.createElement("div");
          card.className = `player-card card-appear ${
            goldIndexes.has(idx) ? "gold" : ""
          }`;
          card.dataset.idx = idx;

          card.innerHTML = `
                    <div class="img" style="background-image: url('${player.image}')"></div>
                    <div class="meta">
                        <div class="name">${player.name}</div>
                        <div class="sub">Futbolcu</div>
                    </div>
                `;

          card.addEventListener("click", () => {
            if (!gameActive || !isMyTurn || usedCards.has(idx)) return;

            if (selectedCardIndex === idx) {
              selectedCardIndex = null;
              card.classList.remove("selected");
              playCardBtn.disabled = true;
            } else {
              document
                .querySelectorAll(".player-card")
                .forEach((c) => c.classList.remove("selected"));
              selectedCardIndex = idx;
              card.classList.add("selected");
              playCardBtn.disabled = false;
            }
          });

          cardsWrap.appendChild(card);
        });
      }

      // Update question display
      function updateQuestion() {
        if (currentRound <= totalRounds) {
          const questions = [
            "Hangi futbolcu daha fazla gol atmÄ±ÅŸtÄ±r?",
            "Hangi futbolcu daha fazla asist yapmÄ±ÅŸtÄ±r?",
            "Hangi futbolcu daha fazla kupa kazanmÄ±ÅŸtÄ±r?",
            "Hangi futbolcu daha fazla maÃ§ oynamÄ±ÅŸtÄ±r?",
            "Hangi futbolcu daha deÄŸerlidir?",
            "Hangi futbolcu daha genÃ§tir?",
            "Hangi futbolcu daha uzun boyludur?",
            "Hangi futbolcu daha hÄ±zlÄ±dÄ±r?",
          ];

          const questionIndex = (currentRound - 1) % questions.length;
          currentQuestionEl.textContent = questions[questionIndex];
          roundLabel.textContent = `Tur ${currentRound} / ${totalRounds}`;
        }
      }

      // Update turn indicator
      function updateTurnIndicator(turnPlayerId) {
        isMyTurn = turnPlayerId === playerId;
        if (isMyTurn) {
          turnIndicator.textContent = "SÄ±ra: Sizde!";
          turnIndicator.style.color = "#2ecc71";
        } else {
          turnIndicator.textContent = "SÄ±ra: Rakipte";
          turnIndicator.style.color = "#e74c3c";
        }
      }

      // Update scores
      function updateScores() {
        myScoreEl.textContent = myScore;
        oppScoreEl.textContent = oppScore;
      }

      // Update players list
      function updatePlayersList(players) {
        playerListEl.innerHTML = "";
        players.forEach((player) => {
          const playerEl = document.createElement("div");
          playerEl.className = `player ${player.id === playerId ? "me" : ""}`;
          playerEl.textContent = player.id === playerId ? "Siz" : "Rakip";
          playerListEl.appendChild(playerEl);
        });
      }

      // Add to history
      function addToHistory(message) {
        const historyItem = document.createElement("div");
        historyItem.className = "history-item";
        historyItem.textContent = message;
        historyEl.prepend(historyItem);
      }

      // Update URL with room ID
      function updateURL() {
        const newURL = `${window.location.origin}${window.location.pathname}?room=${roomId}`;
        window.history.replaceState({}, "", newURL);
      }

      // Copy link to clipboard
      copyLinkBtn.addEventListener("click", () => {
        const link = `${window.location.origin}${window.location.pathname}?room=${roomId}`;
        navigator.clipboard.writeText(link).then(() => {
          alert("Link kopyalandÄ±! ArkadaÅŸÄ±nÄ±zla paylaÅŸÄ±n.");
        });
      });

      // Placeholder image
      function placeholderDataURL(name) {
        const svg = `<svg xmlns="http://www.w3.org/2000/svg" width="400" height="300" viewBox="0 0 400 300">
                    <rect width="400" height="300" fill="#0b1220"/>
                    <text x="200" y="150" font-family="Arial" font-size="24" fill="#9aa6b2" text-anchor="middle" dominant-baseline="middle">${name}</text>
                </svg>`;
        return "data:image/svg+xml;charset=utf-8," + encodeURIComponent(svg);
      }

      // Initialize with sample names
      fillSample.click();
    </script>
  </body>
</html>
